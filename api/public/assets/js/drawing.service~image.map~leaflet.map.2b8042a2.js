(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["drawing.service~image.map~leaflet.map"],{"4ec9":function(e,t,a){"use strict";var i=a("6d61"),r=a("6566");e.exports=i("Map",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),r)},"5f68":function(e,t,a){"use strict";function i(e){return'<svg xmlns="http://www.w3.org/2000/svg" width="24" heigth="24" viewBox="0 0 24 24">'+e+"</svg>"}function r(e){return"data:image/svg+xml;base64,"+btoa(i(e))}a.d(t,"a",(function(){return r}))},6566:function(e,t,a){"use strict";var i=a("9bf2").f,r=a("7c73"),n=a("e2cc"),s=a("0366"),o=a("19aa"),l=a("2266"),u=a("7dd0"),c=a("2626"),h=a("83ab"),f=a("f183").fastKey,d=a("69f3"),y=d.set,g=d.getterFor;e.exports={getConstructor:function(e,t,a,u){var c=e((function(e,i){o(e,c,t),y(e,{type:t,index:r(null),first:void 0,last:void 0,size:0}),h||(e.size=0),void 0!=i&&l(i,e[u],{that:e,AS_ENTRIES:a})})),d=g(t),v=function(e,t,a){var i,r,n=d(e),s=p(e,t);return s?s.value=a:(n.last=s={index:r=f(t,!0),key:t,value:a,previous:i=n.last,next:void 0,removed:!1},n.first||(n.first=s),i&&(i.next=s),h?n.size++:e.size++,"F"!==r&&(n.index[r]=s)),e},p=function(e,t){var a,i=d(e),r=f(t);if("F"!==r)return i.index[r];for(a=i.first;a;a=a.next)if(a.key==t)return a};return n(c.prototype,{clear:function(){var e=this,t=d(e),a=t.index,i=t.first;while(i)i.removed=!0,i.previous&&(i.previous=i.previous.next=void 0),delete a[i.index],i=i.next;t.first=t.last=void 0,h?t.size=0:e.size=0},delete:function(e){var t=this,a=d(t),i=p(t,e);if(i){var r=i.next,n=i.previous;delete a.index[i.index],i.removed=!0,n&&(n.next=r),r&&(r.previous=n),a.first==i&&(a.first=r),a.last==i&&(a.last=n),h?a.size--:t.size--}return!!i},forEach:function(e){var t,a=d(this),i=s(e,arguments.length>1?arguments[1]:void 0,3);while(t=t?t.next:a.first){i(t.value,t.key,this);while(t&&t.removed)t=t.previous}},has:function(e){return!!p(this,e)}}),n(c.prototype,a?{get:function(e){var t=p(this,e);return t&&t.value},set:function(e,t){return v(this,0===e?0:e,t)}}:{add:function(e){return v(this,e=0===e?0:e,e)}}),h&&i(c.prototype,"size",{get:function(){return d(this).size}}),c},setStrong:function(e,t,a){var i=t+" Iterator",r=g(t),n=g(i);u(e,t,(function(e,t){y(this,{type:i,target:e,state:r(e),kind:t,last:void 0})}),(function(){var e=n(this),t=e.kind,a=e.last;while(a&&a.removed)a=a.previous;return e.target&&(e.last=a=a?a.next:e.state.first)?"keys"==t?{value:a.key,done:!1}:"values"==t?{value:a.value,done:!1}:{value:[a.key,a.value],done:!1}:(e.target=void 0,{value:void 0,done:!0})}),a?"entries":"values",!a,!0),c(t)}}},"6d61":function(e,t,a){"use strict";var i=a("23e7"),r=a("da84"),n=a("94ca"),s=a("6eeb"),o=a("f183"),l=a("2266"),u=a("19aa"),c=a("861d"),h=a("d039"),f=a("1c7e"),d=a("d44e"),y=a("7156");e.exports=function(e,t,a){var g=-1!==e.indexOf("Map"),v=-1!==e.indexOf("Weak"),p=g?"set":"add",_=r[e],m=_&&_.prototype,w=_,k={},b=function(e){var t=m[e];s(m,e,"add"==e?function(e){return t.call(this,0===e?0:e),this}:"delete"==e?function(e){return!(v&&!c(e))&&t.call(this,0===e?0:e)}:"get"==e?function(e){return v&&!c(e)?void 0:t.call(this,0===e?0:e)}:"has"==e?function(e){return!(v&&!c(e))&&t.call(this,0===e?0:e)}:function(e,a){return t.call(this,0===e?0:e,a),this})},S=n(e,"function"!=typeof _||!(v||m.forEach&&!h((function(){(new _).entries().next()}))));if(S)w=a.getConstructor(t,e,g,p),o.enable();else if(n(e,!0)){var T=new w,x=T[p](v?{}:-0,1)!=T,L=h((function(){T.has(1)})),z=f((function(e){new _(e)})),M=!v&&h((function(){var e=new _,t=5;while(t--)e[p](t,t);return!e.has(-0)}));z||(w=t((function(t,a){u(t,w,e);var i=y(new _,t,w);return void 0!=a&&l(a,i[p],{that:i,AS_ENTRIES:g}),i})),w.prototype=m,m.constructor=w),(L||M)&&(b("delete"),b("has"),g&&b("get")),(M||x)&&b(p),v&&m.clear&&delete m.clear}return k[e]=w,i({global:!0,forced:w!=_},k),d(w,e),v||a.setStrong(w,e,g),w}},a005:function(e,t,a){"use strict";a("7db0"),a("b0c0");var i=a("e11e"),r=a("5f68"),n=a("5d57"),s="#3490dc";function o(e){return'<circle cx="12" cy="12" r="6" fill="'+e+'"/>'}function l(e){return'<path d="M0 0h24v24H0z" fill="none"/><circle cx="12" cy="12" r="3.2" fill="'+e+'"/><path d="M9 2L7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2h-3.17L15 2H9zm3 15c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5z" fill="'+e+'"/>'}function u(e,t){e.setIcon(new i["Icon"]({iconUrl:Object(r["a"])(t),iconSize:[18,18],iconAnchor:[9,9]}))}var c={style:function(e,t,a,r){var n='<div class="climb-area">'+a.name+"</div>";r=r||200*-(a.path?a.path.length:0),e.setZIndexOffset(r),e.setIcon(new i["DivIcon"]({className:t,html:n}))},default:function(e){this.style(e.layer,"climb-area-none",e.item)},highlight:function(e){this.style(e.layer,"climb-area-highlight",e.item,1e3)},selected:function(e){this.style(e.layer,"climb-area-selected",e.item)}},h={default:function(e){u(e.layer,o("black"))},highlight:function(e){u(e.layer,o(s))},selected:function(e){u(e.layer,o("orangered"))}},f={default:function(e){var t=e.item.grades.find((function(e){return 10===e[0]}));e.layer.setStyle({color:n["e"][t?t[1]:0],weight:3})},highlight:function(e){e.layer.setStyle({color:s,weight:5})},selected:function(e){e.layer.setStyle({color:"yellow",weight:5}),e.layer.bringToFront()}},d={default:function(e){u(e.layer,l("black"))},highlight:function(e){u(e.layer,l(s))},selected:function(e){u(e.layer,l("orangered"))}},y={default:function(e){var t=e.item.grades.find((function(e){return 10===e[0]}));e.layer.setStyle({color:n["e"][t?t[1]:0],weight:3})},highlight:function(e){e.layer.setStyle({color:s,weight:5})},selected:function(e){e.layer.setStyle({color:"yellow",weight:5}),e.layer.bringToFront()}},g={dashArray:"10 5",default:function(e){e.layer.setStyle({color:"green",dashArray:this.dashArray})},highlight:function(e){e.layer.setStyle({color:s,dashArray:this.dashArray})},selected:function(e){e.layer.setStyle({color:"orangered",dashArray:this.dashArray})}},v={default:function(e){u(e,o("#4285F4"))}},p={map:{area:c,trail:g,pitch:null,route:h,image:d},image:{area:c,trail:g,pitch:y,route:f,image:d},currentLocation:v};t["a"]=p},b922:function(e,t,a){"use strict";a("4160"),a("caad"),a("fb6a"),a("4ec9"),a("d3b7"),a("ac1f"),a("2532"),a("3ca3"),a("1276"),a("159b"),a("ddb0");var i=a("b85c"),r=a("d4ec"),n=a("bee2"),s=a("e11e"),o=a("0613"),l=a("a005"),u=a("a96b");function c(e){return e?e+"m":""}var h={set:function(e,t){e.bindTooltip(t,{permanent:!0,sticky:!0,className:"tooltip",interactive:!0})},route:function(e){var t=e.layer,a=e.item;this.set(t,u["a"].forge(a.grades)+", "+c(a.length))},pitch:function(e){var t=e.layer,a=e.item;this.set(t,u["a"].forge(a.grades)+", "+c(a.length))}},f=h,d=a("5d57"),y=a("f41f"),g=function(){function e(){Object(r["a"])(this,e),this._layerGroup=new s["FeatureGroup"],this._features=new Map,this._anchors=new Map,this._selected=[],this._tooltipsClosed=!1,this._lastLayerBounds=void 0,this._lastLayerSurfaceSize=1e3,this.registerHighlightWatch()}return Object(n["a"])(e,[{key:"registerHighlightWatch",value:function(){var e=this;o["a"].watch((function(){return y["a"].key}),(function(t){e.refreshStyle(t)}))}},{key:"registerTagsWatch",value:function(){var e=this;this._unwatchTags=o["a"].watch((function(e,t){return t.tags}),(function(t){o["a"].getters.loading||(e.setSelectedKeys(),e.addTagsToView(t))}),{immediate:!0})}},{key:"setSelectedKeys",value:function(){var e;this._selected=[];var t=null===(e=o["a"].state.url)||void 0===e?void 0:e.params;for(var a in t){var r=a.slice(0,-2),n=t[a],s=r+n;if(this._selected.push(s),r===d["b"].Route){var l=o["a"].getters[d["b"].Route+"/find"](n);if(l&&l.pitches){var u,c=Object(i["a"])(l.pitches);try{for(c.s();!(u=c.n()).done;){var h=u.value;this._selected.push(d["b"].Pitch+h)}}catch(f){c.e(f)}finally{c.f()}}}}}},{key:"isSelectedFeature",value:function(e){return this._selected.includes(e)}},{key:"refreshStyle",value:function(e){var t=this;this._features.forEach((function(a,i){e===i?t.setStyle("highlight",a):t.setDefaultStyle(i,a)}))}},{key:"removeLayers",value:function(){var e=this;this._features.forEach((function(t){e._layerGroup.removeLayer(t.layer)})),this._features.clear(),this._anchors.forEach((function(t){e._layerGroup.removeLayer(t)})),this._anchors.clear()}},{key:"hideTag",value:function(e){var t=this._features.get(e);t&&this._layerGroup.removeLayer(t.layer);var a=this._anchors.get(e);a&&this._layerGroup.removeLayer(a)}},{key:"showTag",value:function(e){var t=this._features.get(e.tagged_type+e.tagged_id);t&&this._layerGroup.addLayer(t.layer)}},{key:"hasTag",value:function(e){return this._features.has(e)}},{key:"getTag",value:function(e){var t;return null===(t=this._features.get(e))||void 0===t?void 0:t.tag}},{key:"addTagsToView",value:function(e){var t=this;this.removeLayers(),this._tooltipsClosed=!1,e.forEach((function(e){var a=e.tagged_type&&o["a"].getters[e.tagged_type+"/find"](e.tagged_id);if(a){var i=t.createLayer(e),r={layer:i,item:a,tag:e},n=e.tagged_type+e.tagged_id;t._features.set(n,r),t.registerListeners(n,r),"image"===t._mapType&&f[e.tagged_type]&&f[e.tagged_type](r),t._layerGroup.addLayer(i)}})),this.refreshStyle(),o["a"].getters.imageOpen?this.addAnchors():this.setMapViewpoint()}},{key:"addAnchors",value:function(){var e=this;this._features.forEach((function(t,a){if(t.tag.tagged_type===d["b"].Route||t.tag.tagged_type===d["b"].Pitch){var i=e.createAnchor(t.tag.geometry.coordinates);e._anchors.set(a,i),e._layerGroup.addLayer(i)}}))}},{key:"setMapViewpoint",value:function(){var e;if(0!==this._layerGroup.getLayers().length){var t=this._layerGroup.getBounds(),a=this.calculateSurface(t),i=18;1===this._features.size&&this._features.forEach((function(e){var t=e.item.path,a=10;i=t?a+2*t.split(".").length:a}));var r=Math.abs(this._lastLayerSurfaceSize-a)<1e-4,n=this._lastLayerBounds&&(this._lastLayerBounds.overlaps(t)||(null===(e=this._lastLayerBounds)||void 0===e?void 0:e.equals(t)));r&&n&&this.lastMapBounds?this._map.fitBounds(this.lastMapBounds):(this._lastLayerBounds=t,this._lastLayerSurfaceSize=a,this.lastMapBounds=void 0,this._map.fitBounds(this._lastLayerBounds,{padding:[100,100],maxZoom:i}))}}},{key:"calculateSurface",value:function(e){var t=e.getWest()-e.getEast(),a=e.getNorth()-e.getSouth();return Math.abs(t*a)}},{key:"setDefaultStyle",value:function(e,t){this.isSelectedFeature(e)?this.setStyle("selected",t):this.setStyle("default",t)}},{key:"setStyle",value:function(e,t){var a=t.tag.tagged_type;l["a"][this._mapType][a]&&l["a"][this._mapType][a][e]({layer:t.layer,item:t.item})}},{key:"createLayer",value:function(e){var t;switch(e.geometry.type){case"Point":t=this.createMarker(e.geometry.coordinates);break;case"LineString":t=this.createPolyline(e.geometry.coordinates);break}return t}},{key:"createAnchor",value:function(e){var t=e[0],a=e[e.length-1],i=a[1]>t[1]?a:t;return new s["CircleMarker"]([i[1],i[0]],{radius:5,stroke:!1,fillOpacity:1,fillColor:"white"})}},{key:"createMarker",value:function(e){return new s["Marker"]([e[1],e[0]])}},{key:"toggleAllTooltips",value:function(){var e;this._tooltipsClosed?(e="openTooltip",this._tooltipsClosed=!1):(e="closeTooltip",this._tooltipsClosed=!0),this._features.forEach((function(t){t.layer[e]()}))}},{key:"createPolyline",value:function(e){var t=[];return e.forEach((function(e){t.push([e[1],e[0]])})),new s["Polyline"](t)}},{key:"registerListeners",value:function(e,t){t.layer.on("mouseover",(function(t){y["a"].key=e,t.target.getTooltip()&&t.target.closeTooltip()})).on("mouseout",(function(e){y["a"].key=null,e.target.getTooltip()&&e.target.openTooltip()})).on("click",(function(e){void 0===e.target.getPopup()&&a.e("popup.service").then(a.bind(null,"3b97")).then((function(a){var i=a.default;i.createPopup(t,e.latlng)}))}))}},{key:"map",set:function(e){this.removeLayers(),this._map=e,null===this._map?this._unwatchTags&&this._unwatchTags():(o["a"].getters.imageOpen?(this._mapType="image",this.lastMapBounds=void 0):this._mapType="map",this._layerGroup.addTo(e),this.registerTagsWatch())},get:function(){return this._map}}]),e}(),v=new g;t["a"]=v}}]);
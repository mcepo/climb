(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["image.map"],{"1f54":function(e,t,a){"use strict";var i=a("5f68"),r=a("e11e"),n={iconUrl:Object(i["a"])('<path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/><path d="M0 0h24v24H0z" fill="none"/>'),iconSize:[20,32],iconAnchor:[10,24],shadowUrl:Object(i["a"])("")};r["Icon"].Default.prototype.options=n,r["Marker"].prototype.options.icon=new r["Icon"](n)},"4ec9":function(e,t,a){"use strict";var i=a("6d61"),r=a("6566");e.exports=i("Map",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),r)},6566:function(e,t,a){"use strict";var i=a("9bf2").f,r=a("7c73"),n=a("e2cc"),o=a("0366"),s=a("19aa"),u=a("2266"),l=a("7dd0"),c=a("2626"),h=a("83ab"),f=a("f183").fastKey,d=a("69f3"),p=d.set,v=d.getterFor;e.exports={getConstructor:function(e,t,a,l){var c=e((function(e,i){s(e,c,t),p(e,{type:t,index:r(null),first:void 0,last:void 0,size:0}),h||(e.size=0),void 0!=i&&u(i,e[l],{that:e,AS_ENTRIES:a})})),d=v(t),y=function(e,t,a){var i,r,n=d(e),o=g(e,t);return o?o.value=a:(n.last=o={index:r=f(t,!0),key:t,value:a,previous:i=n.last,next:void 0,removed:!1},n.first||(n.first=o),i&&(i.next=o),h?n.size++:e.size++,"F"!==r&&(n.index[r]=o)),e},g=function(e,t){var a,i=d(e),r=f(t);if("F"!==r)return i.index[r];for(a=i.first;a;a=a.next)if(a.key==t)return a};return n(c.prototype,{clear:function(){var e=this,t=d(e),a=t.index,i=t.first;while(i)i.removed=!0,i.previous&&(i.previous=i.previous.next=void 0),delete a[i.index],i=i.next;t.first=t.last=void 0,h?t.size=0:e.size=0},delete:function(e){var t=this,a=d(t),i=g(t,e);if(i){var r=i.next,n=i.previous;delete a.index[i.index],i.removed=!0,n&&(n.next=r),r&&(r.previous=n),a.first==i&&(a.first=r),a.last==i&&(a.last=n),h?a.size--:t.size--}return!!i},forEach:function(e){var t,a=d(this),i=o(e,arguments.length>1?arguments[1]:void 0,3);while(t=t?t.next:a.first){i(t.value,t.key,this);while(t&&t.removed)t=t.previous}},has:function(e){return!!g(this,e)}}),n(c.prototype,a?{get:function(e){var t=g(this,e);return t&&t.value},set:function(e,t){return y(this,0===e?0:e,t)}}:{add:function(e){return y(this,e=0===e?0:e,e)}}),h&&i(c.prototype,"size",{get:function(){return d(this).size}}),c},setStrong:function(e,t,a){var i=t+" Iterator",r=v(t),n=v(i);l(e,t,(function(e,t){p(this,{type:i,target:e,state:r(e),kind:t,last:void 0})}),(function(){var e=n(this),t=e.kind,a=e.last;while(a&&a.removed)a=a.previous;return e.target&&(e.last=a=a?a.next:e.state.first)?"keys"==t?{value:a.key,done:!1}:"values"==t?{value:a.value,done:!1}:{value:[a.key,a.value],done:!1}:(e.target=void 0,{value:void 0,done:!0})}),a?"entries":"values",!a,!0),c(t)}}},"6d61":function(e,t,a){"use strict";var i=a("23e7"),r=a("da84"),n=a("94ca"),o=a("6eeb"),s=a("f183"),u=a("2266"),l=a("19aa"),c=a("861d"),h=a("d039"),f=a("1c7e"),d=a("d44e"),p=a("7156");e.exports=function(e,t,a){var v=-1!==e.indexOf("Map"),y=-1!==e.indexOf("Weak"),g=v?"set":"add",m=r[e],_=m&&m.prototype,k=m,b={},w=function(e){var t=_[e];o(_,e,"add"==e?function(e){return t.call(this,0===e?0:e),this}:"delete"==e?function(e){return!(y&&!c(e))&&t.call(this,0===e?0:e)}:"get"==e?function(e){return y&&!c(e)?void 0:t.call(this,0===e?0:e)}:"has"==e?function(e){return!(y&&!c(e))&&t.call(this,0===e?0:e)}:function(e,a){return t.call(this,0===e?0:e,a),this})},T=n(e,"function"!=typeof m||!(y||_.forEach&&!h((function(){(new m).entries().next()}))));if(T)k=a.getConstructor(t,e,v,g),s.enable();else if(n(e,!0)){var S=new k,x=S[g](y?{}:-0,1)!=S,L=h((function(){S.has(1)})),M=f((function(e){new m(e)})),z=!y&&h((function(){var e=new m,t=5;while(t--)e[g](t,t);return!e.has(-0)}));M||(k=t((function(t,a){l(t,k,e);var i=p(new m,t,k);return void 0!=a&&u(a,i[g],{that:i,AS_ENTRIES:v}),i})),k.prototype=_,_.constructor=k),(L||z)&&(w("delete"),w("has"),v&&w("get")),(z||x)&&w(g),y&&_.clear&&delete _.clear}return b[e]=k,i({global:!0,forced:k!=m},b),d(k,e),y||a.setStrong(k,e,v),k}},b922:function(e,t,a){"use strict";a("4160"),a("caad"),a("fb6a"),a("4ec9"),a("d3b7"),a("ac1f"),a("2532"),a("3ca3"),a("1276"),a("159b"),a("ddb0");var i=a("b85c"),r=a("d4ec"),n=a("bee2"),o=a("e11e"),s=a("0613"),u=a("a005"),l=a("a96b");function c(e){return e?e+"m":""}var h={set:function(e,t){e.bindTooltip(t,{permanent:!0,sticky:!0,className:"tooltip",interactive:!0})},route:function(e){var t=e.layer,a=e.item;this.set(t,l["a"].forge(a.grades)+", "+c(a.length))},pitch:function(e){var t=e.layer,a=e.item;this.set(t,l["a"].forge(a.grades)+", "+c(a.length))}},f=h,d=a("5d57"),p=a("f41f"),v=function(){function e(){Object(r["a"])(this,e),this._layerGroup=new o["FeatureGroup"],this._features=new Map,this._anchors=new Map,this._selected=[],this._tooltipsClosed=!1,this._lastLayerBounds=void 0,this._lastLayerSurfaceSize=1e3,this.registerHighlightWatch()}return Object(n["a"])(e,[{key:"registerHighlightWatch",value:function(){var e=this;s["a"].watch((function(){return p["a"].key}),(function(t){e.refreshStyle(t)}))}},{key:"registerTagsWatch",value:function(){var e=this;this._unwatchTags=s["a"].watch((function(e,t){return t.tags}),(function(t){s["a"].getters.loading||(e.setSelectedKeys(),e.addTagsToView(t))}),{immediate:!0})}},{key:"setSelectedKeys",value:function(){var e;this._selected=[];var t=null===(e=s["a"].state.url)||void 0===e?void 0:e.params;for(var a in t){var r=a.slice(0,-2),n=t[a],o=r+n;if(this._selected.push(o),r===d["b"].Route){var u=s["a"].getters[d["b"].Route+"/find"](n);if(u&&u.pitches){var l,c=Object(i["a"])(u.pitches);try{for(c.s();!(l=c.n()).done;){var h=l.value;this._selected.push(d["b"].Pitch+h)}}catch(f){c.e(f)}finally{c.f()}}}}}},{key:"isSelectedFeature",value:function(e){return this._selected.includes(e)}},{key:"refreshStyle",value:function(e){var t=this;this._features.forEach((function(a,i){e===i?t.setStyle("highlight",a):t.setDefaultStyle(i,a)}))}},{key:"removeLayers",value:function(){var e=this;this._features.forEach((function(t){e._layerGroup.removeLayer(t.layer)})),this._features.clear(),this._anchors.forEach((function(t){e._layerGroup.removeLayer(t)})),this._anchors.clear()}},{key:"hideTag",value:function(e){var t=this._features.get(e);t&&this._layerGroup.removeLayer(t.layer);var a=this._anchors.get(e);a&&this._layerGroup.removeLayer(a)}},{key:"showTag",value:function(e){var t=this._features.get(e.tagged_type+e.tagged_id);t&&this._layerGroup.addLayer(t.layer)}},{key:"hasTag",value:function(e){return this._features.has(e)}},{key:"getTag",value:function(e){var t;return null===(t=this._features.get(e))||void 0===t?void 0:t.tag}},{key:"addTagsToView",value:function(e){var t=this;this.removeLayers(),this._tooltipsClosed=!1,e.forEach((function(e){var a=e.tagged_type&&s["a"].getters[e.tagged_type+"/find"](e.tagged_id);if(a){var i=t.createLayer(e),r={layer:i,item:a,tag:e},n=e.tagged_type+e.tagged_id;t._features.set(n,r),t.registerListeners(n,r),"image"===t._mapType&&f[e.tagged_type]&&f[e.tagged_type](r),t._layerGroup.addLayer(i)}})),this.refreshStyle(),s["a"].getters.imageOpen?this.addAnchors():this.setMapViewpoint()}},{key:"addAnchors",value:function(){var e=this;this._features.forEach((function(t,a){if(t.tag.tagged_type===d["b"].Route||t.tag.tagged_type===d["b"].Pitch){var i=e.createAnchor(t.tag.geometry.coordinates);e._anchors.set(a,i),e._layerGroup.addLayer(i)}}))}},{key:"setMapViewpoint",value:function(){var e;if(0!==this._layerGroup.getLayers().length){var t=this._layerGroup.getBounds(),a=this.calculateSurface(t),i=18;1===this._features.size&&this._features.forEach((function(e){var t=e.item.path,a=10;i=t?a+2*t.split(".").length:a}));var r=Math.abs(this._lastLayerSurfaceSize-a)<1e-4,n=this._lastLayerBounds&&(this._lastLayerBounds.overlaps(t)||(null===(e=this._lastLayerBounds)||void 0===e?void 0:e.equals(t)));r&&n&&this.lastMapBounds?this._map.fitBounds(this.lastMapBounds):(this._lastLayerBounds=t,this._lastLayerSurfaceSize=a,this.lastMapBounds=void 0,this._map.fitBounds(this._lastLayerBounds,{padding:[100,100],maxZoom:i}))}}},{key:"calculateSurface",value:function(e){var t=e.getWest()-e.getEast(),a=e.getNorth()-e.getSouth();return Math.abs(t*a)}},{key:"setDefaultStyle",value:function(e,t){this.isSelectedFeature(e)?this.setStyle("selected",t):this.setStyle("default",t)}},{key:"setStyle",value:function(e,t){var a=t.tag.tagged_type;u["a"][this._mapType][a]&&u["a"][this._mapType][a][e]({layer:t.layer,item:t.item})}},{key:"createLayer",value:function(e){var t;switch(e.geometry.type){case"Point":t=this.createMarker(e.geometry.coordinates);break;case"LineString":t=this.createPolyline(e.geometry.coordinates);break}return t}},{key:"createAnchor",value:function(e){var t=e[0],a=e[e.length-1],i=a[1]>t[1]?a:t;return new o["CircleMarker"]([i[1],i[0]],{radius:5,stroke:!1,fillOpacity:1,fillColor:"white"})}},{key:"createMarker",value:function(e){return new o["Marker"]([e[1],e[0]])}},{key:"toggleAllTooltips",value:function(){var e;this._tooltipsClosed?(e="openTooltip",this._tooltipsClosed=!1):(e="closeTooltip",this._tooltipsClosed=!0),this._features.forEach((function(t){t.layer[e]()}))}},{key:"createPolyline",value:function(e){var t=[];return e.forEach((function(e){t.push([e[1],e[0]])})),new o["Polyline"](t)}},{key:"registerListeners",value:function(e,t){t.layer.on("mouseover",(function(t){p["a"].key=e,t.target.getTooltip()&&t.target.closeTooltip()})).on("mouseout",(function(e){p["a"].key=null,e.target.getTooltip()&&e.target.openTooltip()})).on("click",(function(e){void 0===e.target.getPopup()&&a.e("popup.service").then(a.bind(null,"3b97")).then((function(a){var i=a.default;i.createPopup(t,e.latlng)}))}))}},{key:"map",set:function(e){this.removeLayers(),this._map=e,null===this._map?this._unwatchTags&&this._unwatchTags():(s["a"].getters.imageOpen?(this._mapType="image",this.lastMapBounds=void 0):this._mapType="map",this._layerGroup.addTo(e),this.registerTagsWatch())},get:function(){return this._map}}]),e}(),y=new v;t["a"]=y},d82e:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"map"},[a("v-layout",{staticClass:"map-button justify-space-between",staticStyle:{position:"fixed",height:"90px"},attrs:{column:""}},[a("v-btn",{attrs:{title:"Toogle tooltips",fab:"",small:""},on:{click:function(t){return e.toogleAllTooltips()}}},[a("v-icon",[e._v("chat_bubble_outline")])],1),a("v-btn",{attrs:{title:"Open map",fab:"",small:""},on:{click:function(t){return e.openMap()}}},[a("v-icon",[e._v("map")])],1)],1),a("div",{staticClass:"map",attrs:{id:"image-map"}})],1)},r=[],n=(a("d81d"),a("1f54"),a("e11e")),o=a("5033"),s=a("b922"),u=a("afbc"),l={map:null,mounted:function(){this.$options.map=new n["Map"]("image-map",{center:[0,0],zoom:3,minZoom:1,maxZoom:13,maxBoundsViscosity:1,zoomControl:!1,crs:n["CRS"].Simple,renderer:new n["Canvas"]({tolerance:5})}),o["a"].map=this.$options.map,s["a"].map=this.$options.map,n["control"].zoom({position:"bottomright"}).addTo(this.$options.map)},methods:{openMap:function(){this.$router.push(Object(u["b"])("image",null))},toogleAllTooltips:function(){s["a"].toggleAllTooltips()}},destroyed:function(){s["a"].map=null,o["a"].map=null}},c=l,h=a("2877"),f=a("6544"),d=a.n(f),p=a("8336"),v=a("132d"),y=a("a722"),g=Object(h["a"])(c,i,r,!1,null,null,null);t["default"]=g.exports;d()(g,{VBtn:p["a"],VIcon:v["a"],VLayout:y["a"]})}}]);
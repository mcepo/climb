(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["image.service"],{5033:function(e,t,r){"use strict";r.r(t),r.d(t,"ImageService",(function(){return p}));r("d3b7"),r("96cf");var n=r("1da1"),a=r("3835"),u=r("d4ec"),i=r("bee2"),s=r("e11e"),c=r("0613"),o=r("842b"),h=r("17b6"),p=function(){function e(){Object(u["a"])(this,e)}return Object(i["a"])(e,[{key:"registerImageWatch",value:function(){var e=this;this._unWatchStore=c["a"].watch((function(e,t){return t["image/get"]}),(function(t,r){t&&t.id!==(null===r||void 0===r?void 0:r.id)&&e.open(t)}),{immediate:!0})}},{key:"getBoundsDepricated",value:function(e){var t=Object(a["a"])(e,2),r=t[0],n=t[1];return new s["LatLngBounds"](new s["LatLng"](0,0),new s["LatLng"](n/10,r/10))}},{key:"getBounds",value:function(e){var t=Object(a["a"])(e,2),r=t[0],n=t[1];return new s["LatLngBounds"](new s["LatLng"](-r,n),new s["LatLng"](r,-n))}},{key:"getMaxBounds",value:function(e){return e.pad(.3)}},{key:"open",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=t.boundary?this.getBounds(t.boundary):this.getBoundsDepricated(t.size),this._map.setMaxBounds(this.getMaxBounds(r)),this._map.fitBounds(r),this._imageOverlayThumbnail&&this._map.removeLayer(this._imageOverlayThumbnail),this._imageOverlay&&this._map.removeLayer(this._imageOverlay),e.t0=s["imageOverlay"],e.next=8,this.getImage(t.id,"thumbnail");case 8:return e.t1=e.sent,e.t2=r,this._imageOverlayThumbnail=(0,e.t0)(e.t1,e.t2),this._map.addLayer(this._imageOverlayThumbnail),e.t3=s["imageOverlay"],e.next=15,this.getImage(t.id);case 15:e.t4=e.sent,e.t5=r,e.t6={zIndex:2},this._imageOverlay=(0,e.t3)(e.t4,e.t5,e.t6),this._map.addLayer(this._imageOverlay);case 20:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getImage",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(t){var r,n,a=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=a.length>1&&void 0!==a[1]?a[1]:null,n="image/"+t,r&&(n+="/"+r),r=null!==r&&void 0!==r?r:"full",e.next=6,this.fetchImage(r+"-"+t,n);case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"fetchImage",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(t,r){var n,a,u=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=u.length>2&&void 0!==u[2]?u[2]:"jpeg",e.next=3,this.loadImageFromCache(t,n);case 3:if(e.t0=e.sent,e.t0){e.next=8;break}return e.next=7,this.getAndCacheImage(t,r);case 7:e.t0=e.sent;case 8:if(a=e.t0,!a){e.next=11;break}return e.abrupt("return",a);case 11:return e.abrupt("return",r);case 12:case"end":return e.stop()}}),e,this)})));function t(t,r){return e.apply(this,arguments)}return t}()},{key:"loadImageFromCache",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(t,r){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,h["b"].readFile({path:t,directory:h["a"].Cache});case 3:return n=e.sent,e.abrupt("return","data:image/"+r+";base64,"+n.data);case 7:return e.prev=7,e.t0=e["catch"](0),e.abrupt("return",null);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));function t(t,r){return e.apply(this,arguments)}return t}()},{key:"getAndCacheImage",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(t,r){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.getBase64Image(r);case 2:if(n=e.sent,n){e.next=5;break}return e.abrupt("return",null);case 5:return h["b"].writeFile({path:t,data:n,directory:h["a"].Cache}),e.abrupt("return",n);case 7:case"end":return e.stop()}}),e,this)})));function t(t,r){return e.apply(this,arguments)}return t}()},{key:"getBase64Image",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,o["a"].get(t,{responseType:"blob"});case 3:return r=e.sent,e.next=6,this.convertToBase64(r.data);case 6:return e.abrupt("return",e.sent);case 9:return e.prev=9,e.t0=e["catch"](0),e.abrupt("return",null);case 12:case"end":return e.stop()}}),e,this,[[0,9]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"convertToBase64",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){var n=new FileReader;n.onerror=r,n.onload=function(){e(n.result)},n.readAsDataURL(t)})));case 1:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"map",set:function(e){this._map=e,this._map?this.registerImageWatch():this._unWatchStore&&this._unWatchStore()}}]),e}(),m=new p;t["default"]=m}}]);
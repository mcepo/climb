(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["popup.service","image.service"],{"3b97":function(t,e,n){"use strict";n.r(e);n("fb6a");var r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("popup",{attrs:{tag:t.tag,item:t.item,type:"area"},scopedSlots:t._u([{key:"header",fn:function(){return[n("v-card-subtitle",{staticClass:"pa-0"},[t._v(t._s(t.type))])]},proxy:!0},{key:"item",fn:function(){return[n("h2",[t._v(t._s(t.item.name))])]},proxy:!0},{key:"content",fn:function(){return[n("area-stats",{attrs:{item:t.item}})]},proxy:!0}])})},a=[],i=n("2b0e"),u=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-card",{staticClass:"popup-box",attrs:{flat:""}},[t._t("header"),n("a",{on:{click:function(e){return t.openItem()}}},[t._t("item")],2),t._t("content"),n("v-divider"),t.tag.accuracy?n("div",{staticClass:"pt-2"},[n("b",[t._v("Location accuracy:")]),t._v(" ~"+t._s(t.tag.accuracy)+"m")]):t._e(),n("v-card-actions",[n("tag-control",{attrs:{type:t.type,item:t.item}}),n("delete-button",{attrs:{type:"tag",item:t.tag}})],1)],2)},s=[],o=(n("9911"),n("b79f")),c=n("69c5"),p=n("0613"),l=n("0670"),m=n("afbc"),h=n("b005"),d=i["a"].extend({store:p["a"],vuetify:l["a"],router:m["a"],props:["tag","item","type","url"],components:{TagControl:c["a"],DeleteButton:o["a"]},computed:{link:function(){return this.url||Object(m["b"])(this.type,this.item.id)}},methods:{openItem:function(){this.$router.push(this.link),h["a"].setLeft("image"!==this.type)}}}),g=d,f=n("2877"),v=n("6544"),y=n.n(v),b=n("b0af"),_=n("99d9"),x=n("ce7e"),k=Object(f["a"])(g,u,s,!1,null,null,null),w=k.exports;y()(k,{VCard:b["a"],VCardActions:_["a"],VDivider:x["a"]});var O=n("c6a6"),j=n("5d57"),L=i["a"].extend({props:["item","tag"],components:{Popup:w,AreaStats:O["a"]},computed:{type:function(){return j["d"].getTypeName(j["b"].Area,this.item.type_id)}}}),C=L,I=Object(f["a"])(C,r,a,!1,null,null,null),R=I.exports;y()(I,{VCardSubtitle:_["b"]});var B=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("popup",{attrs:{tag:t.tag,item:t.item,type:"image"},scopedSlots:t._u([{key:"item",fn:function(){return[n("v-img",{attrs:{src:t.src,onerror:"this.style.display='none'",width:"100%",contain:""},on:{load:function(e){t.loading=!1}}},[t.loading?n("v-skeleton-loader",{attrs:{type:"image",height:t.height}}):t._e(),t.loading?t._e():n("v-overlay",{attrs:{absolute:!0,value:!0}},[t._v(" Click me ")])],1)]},proxy:!0}])})},S=[],P=(n("d3b7"),n("5033"),i["a"].extend({props:["item","tag"],components:{Popup:w},data:function(){return{loading:!0,src:""}},created:function(){var t=this;this.item&&Promise.resolve().then(n.bind(null,"5033")).then((function(e){e.default.getImage(t.item.id,"thumbnail").then((function(e){t.src=e}))}))},computed:{height:function(){var t=this.item.size[1]/this.item.size[0];return 200*t+"px"}}})),T=P,V=n("adda"),$=n("a797"),A=n("3129"),D=Object(f["a"])(T,B,S,!1,null,null,null),E=D.exports;y()(D,{VImg:V["a"],VOverlay:$["a"],VSkeletonLoader:A["a"]});var F=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("popup",{attrs:{tag:t.tag,item:t.item,type:"pitch",url:t.url},scopedSlots:t._u([{key:"header",fn:function(){return[n("v-card-subtitle",{staticClass:"pa-0"},[t._v("Pitch")])]},proxy:!0},{key:"item",fn:function(){return[n("h2",[t._v(t._s(t.route.name))])]},proxy:!0},{key:"content",fn:function(){return[n("v-layout",{attrs:{"justify-space-between":""}},[n("div",[t._v(t._s(t.grade))]),n("div",[t._v(t._s(t.length))])])]},proxy:!0}])})},W=[],z=n("a96b"),M=i["a"].extend({props:["item","tag"],components:{Popup:w},computed:{url:function(){return Object(m["b"])("route",this.item.route_id)},route:function(){return p["a"].state.route.byIds[this.item.route_id]},grade:function(){return this.item&&z["a"].forge(this.item.grades)},length:function(){return this.item.length?this.item.length+"m":""}}}),J=M,N=n("a722"),U=Object(f["a"])(J,F,W,!1,null,null,null),q=U.exports;y()(U,{VCardSubtitle:_["b"],VLayout:N["a"]});var G=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("popup",{attrs:{tag:t.tag,item:t.item,type:"route"},scopedSlots:t._u([{key:"header",fn:function(){return[n("v-card-subtitle",{staticClass:"pa-0"},[t._v(t._s(t.type))])]},proxy:!0},{key:"item",fn:function(){return[n("h2",[t._v(t._s(t.item.name))])]},proxy:!0},{key:"content",fn:function(){return[n("v-layout",{attrs:{"justify-space-between":""}},[n("div",[t._v(t._s(t.grade))]),n("div",[t._v(t._s(t.length))])])]},proxy:!0}])})},H=[],K=i["a"].extend({props:["item","tag"],components:{Popup:w},computed:{type:function(){return j["d"].getTypeName(j["b"].Route,this.item.type_id)},grade:function(){return this.item&&z["a"].forge(this.item.grades)},length:function(){return this.item.length?this.item.length+"m":""}}}),Q=K,X=Object(f["a"])(Q,G,H,!1,null,null,null),Y=X.exports;y()(X,{VCardSubtitle:_["b"],VLayout:N["a"]});var Z=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("popup",{attrs:{tag:t.tag,item:t.item,type:"trail"},scopedSlots:t._u([{key:"header",fn:function(){return[n("v-card-subtitle",{staticClass:"pa-0"},[t._v("Trail")])]},proxy:!0},{key:"item",fn:function(){return[n("h2",[t._v(t._s(t.item.name))])]},proxy:!0},{key:"content",fn:function(){},proxy:!0}])})},tt=[],et=i["a"].extend({props:["item","tag"],components:{Popup:w}}),nt=et,rt=Object(f["a"])(nt,Z,tt,!1,null,null,null),at=rt.exports;y()(rt,{VCardSubtitle:_["b"]});var it={Area:R,Image:E,Pitch:q,Route:Y,Trail:at},ut={createPopup:function(t,e){var n=t.tag.tagged_type.charAt(0).toUpperCase()+t.tag.tagged_type.slice(1),r=it[n];t.layer.bindPopup(new r({propsData:{item:t.item,tag:t.tag}}).$mount().$el).openPopup(e)}};e["default"]=ut},5033:function(t,e,n){"use strict";n.r(e),n.d(e,"ImageService",(function(){return l}));n("d3b7"),n("96cf");var r=n("1da1"),a=n("3835"),i=n("d4ec"),u=n("bee2"),s=n("e11e"),o=n("0613"),c=n("842b"),p=n("17b6"),l=function(){function t(){Object(i["a"])(this,t)}return Object(u["a"])(t,[{key:"registerImageWatch",value:function(){var t=this;this._unWatchStore=o["a"].watch((function(t,e){return e["image/get"]}),(function(e,n){e&&e.id!==(null===n||void 0===n?void 0:n.id)&&t.open(e)}),{immediate:!0})}},{key:"getBoundsDepricated",value:function(t){var e=Object(a["a"])(t,2),n=e[0],r=e[1];return new s["LatLngBounds"](new s["LatLng"](0,0),new s["LatLng"](r/10,n/10))}},{key:"getBounds",value:function(t){var e=Object(a["a"])(t,2),n=e[0],r=e[1];return new s["LatLngBounds"](new s["LatLng"](-n,r),new s["LatLng"](n,-r))}},{key:"getMaxBounds",value:function(t){return t.pad(.3)}},{key:"open",value:function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(e){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=e.boundary?this.getBounds(e.boundary):this.getBoundsDepricated(e.size),this._map.setMaxBounds(this.getMaxBounds(n)),this._map.fitBounds(n),this._imageOverlayThumbnail&&this._map.removeLayer(this._imageOverlayThumbnail),this._imageOverlay&&this._map.removeLayer(this._imageOverlay),t.t0=s["imageOverlay"],t.next=8,this.getImage(e.id,"thumbnail");case 8:return t.t1=t.sent,t.t2=n,this._imageOverlayThumbnail=(0,t.t0)(t.t1,t.t2),this._map.addLayer(this._imageOverlayThumbnail),t.t3=s["imageOverlay"],t.next=15,this.getImage(e.id);case 15:t.t4=t.sent,t.t5=n,t.t6={zIndex:2},this._imageOverlay=(0,t.t3)(t.t4,t.t5,t.t6),this._map.addLayer(this._imageOverlay);case 20:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}()},{key:"getImage",value:function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(e){var n,r,a=arguments;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=a.length>1&&void 0!==a[1]?a[1]:null,r="image/"+e,n&&(r+="/"+n),n=null!==n&&void 0!==n?n:"full",t.next=6,this.fetchImage(n+"-"+e,r);case 6:return t.abrupt("return",t.sent);case 7:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}()},{key:"fetchImage",value:function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(e,n){var r,a,i=arguments;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r=i.length>2&&void 0!==i[2]?i[2]:"jpeg",t.next=3,this.loadImageFromCache(e,r);case 3:if(t.t0=t.sent,t.t0){t.next=8;break}return t.next=7,this.getAndCacheImage(e,n);case 7:t.t0=t.sent;case 8:if(a=t.t0,!a){t.next=11;break}return t.abrupt("return",a);case 11:return t.abrupt("return",n);case 12:case"end":return t.stop()}}),t,this)})));function e(e,n){return t.apply(this,arguments)}return e}()},{key:"loadImageFromCache",value:function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(e,n){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,p["b"].readFile({path:e,directory:p["a"].Cache});case 3:return r=t.sent,t.abrupt("return","data:image/"+n+";base64,"+r.data);case 7:return t.prev=7,t.t0=t["catch"](0),t.abrupt("return",null);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})));function e(e,n){return t.apply(this,arguments)}return e}()},{key:"getAndCacheImage",value:function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(e,n){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.getBase64Image(n);case 2:if(r=t.sent,r){t.next=5;break}return t.abrupt("return",null);case 5:return p["b"].writeFile({path:e,data:r,directory:p["a"].Cache}),t.abrupt("return",r);case 7:case"end":return t.stop()}}),t,this)})));function e(e,n){return t.apply(this,arguments)}return e}()},{key:"getBase64Image",value:function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(e){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,c["a"].get(e,{responseType:"blob"});case 3:return n=t.sent,t.next=6,this.convertToBase64(n.data);case 6:return t.abrupt("return",t.sent);case 9:return t.prev=9,t.t0=t["catch"](0),t.abrupt("return",null);case 12:case"end":return t.stop()}}),t,this,[[0,9]])})));function e(e){return t.apply(this,arguments)}return e}()},{key:"convertToBase64",value:function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(e){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t,n){var r=new FileReader;r.onerror=n,r.onload=function(){t(r.result)},r.readAsDataURL(e)})));case 1:case"end":return t.stop()}}),t)})));function e(e){return t.apply(this,arguments)}return e}()},{key:"map",set:function(t){this._map=t,this._map?this.registerImageWatch():this._unWatchStore&&this._unWatchStore()}}]),t}(),m=new l;e["default"]=m}}]);